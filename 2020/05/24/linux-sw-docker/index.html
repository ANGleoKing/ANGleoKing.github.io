<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>linux-sw-docker | Alex</title><meta name="description" content="linux-sw-docker"><meta name="keywords" content="linux,sw,docker"><meta name="author" content="Alex"><meta name="copyright" content="Alex"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="linux-sw-docker"><meta name="twitter:description" content="linux-sw-docker"><meta name="twitter:image" content="https://herycs.github.io/img/post.jpg"><meta property="og:type" content="article"><meta property="og:title" content="linux-sw-docker"><meta property="og:url" content="https://herycs.github.io/2020/05/24/linux-sw-docker/"><meta property="og:site_name" content="Alex"><meta property="og:description" content="linux-sw-docker"><meta property="og:image" content="https://herycs.github.io/img/post.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://herycs.github.io/2020/05/24/linux-sw-docker/"><link rel="prev" title="linux-cmd-chmod" href="https://herycs.github.io/2020/05/24/linux-cmd-chmod/"><link rel="next" title="java-b-Map" href="https://herycs.github.io/2020/05/24/java-b-Map/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">28</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">16</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/documents"><i class="fa-fw fa fa-music"></i><span> Documents</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#docker"><span class="toc-number">1.</span> <span class="toc-text">docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基础操作"><span class="toc-number">1.1.</span> <span class="toc-text">基础操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器操作"><span class="toc-number">1.2.</span> <span class="toc-text">容器操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#搜索镜像"><span class="toc-number">1.2.1.</span> <span class="toc-text">搜索镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下载镜像"><span class="toc-number">1.2.2.</span> <span class="toc-text">下载镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#制作容器"><span class="toc-number">1.2.3.</span> <span class="toc-text">制作容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#es"><span class="toc-number">1.2.4.</span> <span class="toc-text">es</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mq"><span class="toc-number">1.2.5.</span> <span class="toc-text">mq</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#registry"><span class="toc-number">1.2.6.</span> <span class="toc-text">registry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jenkins"><span class="toc-number">1.2.7.</span> <span class="toc-text">jenkins</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#登录容器"><span class="toc-number">1.3.</span> <span class="toc-text">登录容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#打包镜像"><span class="toc-number">1.4.</span> <span class="toc-text">打包镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#端口映射"><span class="toc-number">1.5.</span> <span class="toc-text">端口映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#批量操作"><span class="toc-number">1.6.</span> <span class="toc-text">批量操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ps"><span class="toc-number">1.6.1.</span> <span class="toc-text">ps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#镜像批量操作"><span class="toc-number">1.6.2.</span> <span class="toc-text">镜像批量操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-1"><span class="toc-number">1.7.</span> <span class="toc-text">docker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-number">1.7.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动"><span class="toc-number">1.7.2.</span> <span class="toc-text">启动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MAVEN构建镜像"><span class="toc-number">1.8.</span> <span class="toc-text">MAVEN构建镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加许可"><span class="toc-number">1.8.1.</span> <span class="toc-text">添加许可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构建并上传"><span class="toc-number">1.8.2.</span> <span class="toc-text">构建并上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#报错处理"><span class="toc-number">1.8.3.</span> <span class="toc-text">报错处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#报错"><span class="toc-number">1.9.</span> <span class="toc-text">报错</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#net"><span class="toc-number">1.9.1.</span> <span class="toc-text">net</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jenkins-1"><span class="toc-number">1.9.2.</span> <span class="toc-text">jenkins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql远程连接10060"><span class="toc-number">1.9.3.</span> <span class="toc-text">mysql远程连接10060</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mvn"><span class="toc-number">1.9.4.</span> <span class="toc-text">mvn</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#卸载"><span class="toc-number">1.10.</span> <span class="toc-text">卸载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jdk"><span class="toc-number">1.11.</span> <span class="toc-text">jdk</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker-a-cs"><span class="toc-number">2.</span> <span class="toc-text">docker-a-cs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#创建CA秘钥文件夹"><span class="toc-number">2.1.</span> <span class="toc-text">创建CA秘钥文件夹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建密码"><span class="toc-number">2.2.</span> <span class="toc-text">创建密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建白名单将Docker守护程序密钥的扩展使用属性设置为仅用于服务器身份验"><span class="toc-number">2.3.</span> <span class="toc-text">创建白名单将Docker守护程序密钥的扩展使用属性设置为仅用于服务器身份验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#签名证书"><span class="toc-number">2.4.</span> <span class="toc-text">签名证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#清理现场并增加安全性"><span class="toc-number">2.5.</span> <span class="toc-text">清理现场并增加安全性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#证书移交至docker"><span class="toc-number">2.6.</span> <span class="toc-text">证书移交至docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下载证书到本地"><span class="toc-number">2.7.</span> <span class="toc-text">下载证书到本地</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Idea添加docker认证"><span class="toc-number">2.8.</span> <span class="toc-text">Idea添加docker认证</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/post.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Alex</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/documents"><i class="fa-fw fa fa-music"></i><span> Documents</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">linux-sw-docker</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-05-24 22:10:41"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-05-24</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-05-24 22:10:41"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-05-24</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/linux/">linux</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h1><blockquote>
<p>容器化管理软件</p>
<p>主要操作：镜像—&gt;容器</p>
<p>流程：查找镜像，下载镜像，制作容器，操作容器（启动，停止，删除）</p>
<p>镜像类似于java类的概念是一个模板，而容器是基于此模板的一个实例化的具体产品</p>
</blockquote>
<h2 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h2><p>删除镜像</p>
<p>docker rmi [镜像ID]</p>
<p>启动容器</p>
<p>docker run [容器ID]</p>
<p>停止容器</p>
<p>docker stop [容器ID]</p>
<p>查看所有容器</p>
<p>docker ps -a</p>
<h2 id="容器操作"><a href="#容器操作" class="headerlink" title="容器操作"></a>容器操作</h2><h3 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h3><p>docker search [需要查询的镜像名，例如：mysql]</p>
<h3 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h3><p>dcker pull [search名称查找出来的镜像名]</p>
<blockquote>
<p>如果要下载指定版本后面可以跟“ : 版本号”,否则下载的是最新版</p>
<p>例如：docker pull mysql 则会下载最新版，docker pull mysql:5.7.6 则下载的是mysql-5.7.6版本</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:5.6.8</span><br><span class="line">docker pull mobz/elasticsearch-head:5</span><br><span class="line">docker pull gogs/gogs</span><br><span class="line">docker pull grafana/grafana</span><br><span class="line">docker pull rabbitmq</span><br><span class="line">docker pull mysql</span><br><span class="line">docker pull redis</span><br><span class="line">docker pull tutum/influxdb</span><br><span class="line">docker pull rancher/server</span><br><span class="line">docker pull mongo</span><br><span class="line">docker pull registry</span><br><span class="line">docker pull google/cadvisor</span><br><span class="line">docker pull jenkins</span><br></pre></td></tr></table></figure>

<h3 id="制作容器"><a href="#制作容器" class="headerlink" title="制作容器"></a>制作容器</h3><blockquote>
<p>利用已有的镜像制作容器</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">//mysql</span><br><span class="line">docker run -di --name=[innerMysql] -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123 [imageName] : [version](已经是最新版则不需要添加此参数)</span><br><span class="line">不修改配置文件，mysql默认监听3306</span><br><span class="line">docker run -d --name selfdefinename -p 10086:3306 -e MYSQL_ROOT_PASSWORD=rw mysql:5.6</span><br><span class="line">//redis </span><br><span class="line">docker run -di --name=itaobao_resdis -p 6379:6379 redis</span><br><span class="line">//mongo</span><br><span class="line">mkdir -p /usr/mongo/data/db</span><br><span class="line">docker run -di --name=itaoabo_mongo -p 27017:27017 mongo</span><br><span class="line">docker run -di --name=itaoabo_mongo -v /usr/mongo/data/db:/data/db -p 27017:27017 mongo</span><br><span class="line">//es</span><br><span class="line">docker run -dit --name=itaobao_es -p 9200:9200 -p 9300:9300 elasticsearch:5.6.8</span><br><span class="line">//es-head</span><br><span class="line">docker run -di --name=itaoabo_head -p 9100:9100 mobz/elasticsearch-head:5</span><br><span class="line">//rabbitmq</span><br><span class="line">docker run -di --name=itaobao_mq -p 5671:5671 -p 5672:5672 -p 4369:4369 -p 15671:15671 -p 15672:15672 -p 25672:25672 rabbitmq</span><br><span class="line">//registry</span><br><span class="line">docker run -di --name=itaobao_registry -p 5000:5000 registry</span><br><span class="line">docker run -di --name=itaobao_registry -v itaobao_registry/data:/var/lib/registry -p 5000:5000 registry</span><br><span class="line">//gogs</span><br><span class="line">docker run -di --name=itaobao_gogs -p 10022:22 -p 3000:3000 -v /var/gogsdata:/data  gogs/gogs</span><br><span class="line">//jenkins，可在线下载也可上传</span><br><span class="line">wget https://pkg.jenkins.io/redhat/jenkins-2.156-1.1.noarch.rpm</span><br><span class="line">rpm -ivh jenkins-2.156-1.1.noarch.rpm</span><br><span class="line">//rancher</span><br><span class="line">docker run -d --name=itaobao_rancher --restart=always -p 9090:8080 rancher/server</span><br><span class="line">//influxdb</span><br><span class="line">docker run -d --name=itaobao_influxdb -p 8083:8083 -p 8086:8086 --expose 8090 --expose 8099 tutum/influxdb</span><br><span class="line">//cadvisor</span><br><span class="line">docker run --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro --publish=8080:8080 --detach=true --link itaobao_influxdb:itaobao_influxdb --name=cadvisor google/cadvisor -storage_driver=influxdb -storage_driver_db=cadvisor -storage_driver_host=itaobao_influxdb:8086</span><br><span class="line">//grafana</span><br><span class="line">docker run -d -p 3001:3000 -e INFLUXDB_HOST=itaobao_influxdb -e INFLUXDB_PORT=8086 -e INFLUXDB_NAME=cadvisor -e INFLUXDB_USER=cadvisor -e INFLUXDB_PASS=cadvisor --link itaobao_influxdb:itaobao_influxdb --name grafana grafana/grafana</span><br><span class="line">//发布微服务</span><br><span class="line">docker run -di --name=itaobao_config -p 12000:12000 122.51.8.208:5000/itaobao_config:1.0-SNAPSHOT</span><br><span class="line">docker run -di --name=itaobao_eureka -p 6868:6868 122.51.8.208:5000/itaobao_eureka:1.0-SNAPSHOT</span><br></pre></td></tr></table></figure>

<h3 id="es"><a href="#es" class="headerlink" title="es"></a>es</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">安装eS需要做以下处理</span><br><span class="line">1.解除9300端口限制</span><br><span class="line"></span><br><span class="line">先安装一次,随后将其文件下拉到本地</span><br><span class="line">docker run -di --name=itaobao_es -p 9200:9200 -p 9300:9300 elasticsearch:5.6.8</span><br><span class="line">docker cp itaobao_es:/usr/share/elasticsearch/config/elasticsearch.yml /usr/local/config/elasticsearch.yml</span><br><span class="line">docker stop itaobao_es</span><br><span class="line">docker rm itaoabo_es</span><br><span class="line"></span><br><span class="line">建立文件映射</span><br><span class="line">docker run -dit --name=itaobao_es -p 9200:9200 -p 9300:9300 -v /usr/local/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml elasticsearch:5.6.8</span><br><span class="line"></span><br><span class="line">取消修改文件.yml中的注释</span><br><span class="line">transport.host:0.0.0.0（限制访问IP）</span><br><span class="line"></span><br><span class="line">2.调整参数，保证es正常运行</span><br><span class="line"></span><br><span class="line">/etc/security/limits.conf追加两行配置，修改其单个进程能申请的软硬件限制</span><br><span class="line">soft nofile 65536</span><br><span class="line">hard nofile 65536</span><br><span class="line"></span><br><span class="line">/etc/sysctl.conf追加</span><br><span class="line">vm.max_map_count=655360</span><br><span class="line"></span><br><span class="line">执行使得参数生效</span><br><span class="line">sysctl -p</span><br><span class="line">重启虚拟机，再次启动容器</span><br><span class="line"></span><br><span class="line">3.添加ik分词器</span><br><span class="line">cp ik itaobao_es:/usr/share/elasticsearch/plugins</span><br><span class="line">重启容器</span><br><span class="line"></span><br><span class="line">4.跨域</span><br><span class="line">追加到共享文件：/user/local/config/elasticsearch.yml</span><br><span class="line">http.cors.enable: true</span><br><span class="line">http.cors allow-origin: "*"</span><br></pre></td></tr></table></figure>

<h3 id="mq"><a href="#mq" class="headerlink" title="mq"></a>mq</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq</span><br><span class="line">安装完没有图形界面,其本身包含，但出于关闭状态，需要打开</span><br><span class="line">进入容器中</span><br><span class="line">docker exec -it itaobao_mq bash</span><br><span class="line">执行（打开图形界面）</span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>

<h3 id="registry"><a href="#registry" class="headerlink" title="registry"></a>registry</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">registry</span><br><span class="line">访问地址</span><br><span class="line">IP:5000/v2/_catalog</span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">追加</span><br><span class="line">&#123;"insecure-registries":["服务器IP:5000"]&#125;</span><br><span class="line">推送镜像至仓库</span><br><span class="line">docker tag [imageName] [ServerIP]:5000/[newName]</span><br></pre></td></tr></table></figure>

<h3 id="jenkins"><a href="#jenkins" class="headerlink" title="jenkins"></a>jenkins</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/jenkins</span><br><span class="line">//修改端口账号,jenkins需要执行一些操作，直接授权root用户会比较方便，或者也可以选择去授权给jenkins用户</span><br><span class="line">JENKINS_USER="root"</span><br><span class="line">JENKINS_PORT="8088"</span><br><span class="line">service jenkins start</span><br><span class="line">/var/lib/jenkins/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure>

<blockquote>
<p>自己创建镜像</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dockerfile构建镜像</span><br><span class="line">docker build -t='imageName' [sourcePath]</span><br></pre></td></tr></table></figure>

<h2 id="登录容器"><a href="#登录容器" class="headerlink" title="登录容器"></a>登录容器</h2><p>docker exec -it itaobao_mysql bash</p>
<h2 id="打包镜像"><a href="#打包镜像" class="headerlink" title="打包镜像"></a>打包镜像</h2><p>docker commit -a “king西阳” -m “a new image” [容器名称或id] [打包的镜像名称]:[标签]</p>
<h2 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h2><p>查找容器ID</p>
<p>docker inspect itaobao_mysql | grep Id</p>
<p><strong>进到/var/lib/docker/containers 目录下找到与 Id 相同的目录，修改 hostconfig.json 和 config.v2.json文件</strong>：</p>
<h2 id="批量操作"><a href="#批量操作" class="headerlink" title="批量操作"></a>批量操作</h2><blockquote>
<p>其实就是使用命令实现对id的批量读取，并添加到操作指令中</p>
</blockquote>
<h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><p>将第一列的参数打印出来</p>
<p>docker ps -a | awk ‘{print $1}’</p>
<ol>
<li><p>批量执行命令</p>
<p> docker ps -a | awk ‘{print $1}’|xargs docker stop</p>
<p> Error response from daemon: No such container: CONTAINER</p>
<p> 过滤Exited状态容器</p>
<p> docker rm <code>docker ps -a|grep Exited|awk &#39;{print $1}&#39;</code></p>
</li>
<li><p>sudo docker rm $(sudo docker ps -qf status=exited)</p>
</li>
<li><p>Docker 1.13版本以后，可以使用 docker containers prune 命令，删除孤立的容器。</p>
<p> sudo docker container prune</p>
</li>
</ol>
<h3 id="镜像批量操作"><a href="#镜像批量操作" class="headerlink" title="镜像批量操作"></a>镜像批量操作</h3><blockquote>
<p>经过对上面的操作，类比操作方式，发现莫名出现的镜像都是TAG为none的</p>
</blockquote>
<p>docker images | grep none | awk ‘{print $3}’</p>
<p>docker rm -i `docker images | grep none | awk ‘{print $3}’</p>
<h2 id="docker-1"><a href="#docker-1" class="headerlink" title="docker"></a>docker</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><strong>查看系统版本</strong></p>
<p>docker官方建议linux3.8以上</p>
<p>uname -a</p>
<p><strong>更新工具</strong></p>
<p>yum update</p>
<p><strong>安装软件包</strong></p>
<p>yum install -y yum-utils device-mapper-persistent-data lvm2</p>
<p><strong>设置源</strong></p>
<blockquote>
<p>国内建议阿里云的仓库</p>
</blockquote>
<p>yum-config-manager –add-repo <a href="http://download.docker.com/linux/centos/docker-ce.repo" target="_blank" rel="noopener">http://download.docker.com/linux/centos/docker-ce.repo</a></p>
<p>yum-config-manager –add-repo <a href="http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo" target="_blank" rel="noopener">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</a></p>
<p><strong>选择版本</strong></p>
<p>yum list docker-ce –showduplicates | sort -r</p>
<p><strong>安装</strong></p>
<p>yum install docker-ce-18.03.1.ce</p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>systemctl start docker</p>
<p>加入开机自启动：systemctl enable  docker</p>
<h2 id="MAVEN构建镜像"><a href="#MAVEN构建镜像" class="headerlink" title="MAVEN构建镜像"></a>MAVEN构建镜像</h2><h3 id="添加许可"><a href="#添加许可" class="headerlink" title="添加许可"></a><strong>添加许可</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /lib/systemd/system/docker.service</span><br><span class="line">ExecStart</span><br><span class="line">追加(IP远程访问Maven的许可)</span><br><span class="line">-H tcp://1.84.16.0:2375 -H unix:///var/run/docker.sock</span><br><span class="line">重载配置</span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<h3 id="构建并上传"><a href="#构建并上传" class="headerlink" title="构建并上传"></a><strong>构建并上传</strong></h3><p>mvn clean package docker:build -DpushImage</p>
<h3 id="报错处理"><a href="#报错处理" class="headerlink" title="报错处理"></a>报错处理</h3><ol>
<li><p>公共模块找不到，无法解决对公共模块的依赖（例如：common模块)</p>
<blockquote>
<p>Could not resolve dependencies for project com.itaobao:itaobao_user:jar:1.0-SNAPSHOT: Failu<br>re to find com.itaobao:itaobao_common:jar:1.0-SNAPSHOT in <a href="https://repo.spring.io/snapshot" target="_blank" rel="noopener">https://repo.spring.io/snapshot</a> was cached in the local repository, resolution will not b<br>e reattempted until the update interval of spring-snapshots has elapsed or updates are forced</p>
</blockquote>
</li>
</ol>
<ul>
<li>公共模块下不需要打包插件，否则在第二次打包编译时会去尝试执行main方法</li>
<li>在确保pom文件无异常情况下可以执行，clean, compose, install更新文件到本地后再试</li>
</ul>
<ol start="2">
<li><p>ssl权限问题</p>
<p> 在pom的build部分添加（不添加的话对于一些安全方面的校验存在问题）</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">defaultGoal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">defaultGoal</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>多次尝试不成功</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">检查各个模块的pom文件无异常情况下尝试在root模块进行install操作,以更新各个模块pom文件及数据</span><br></pre></td></tr></table></figure>
</li>
<li><p>待定</p>
</li>
</ol>
<h2 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h2><h3 id="net"><a href="#net" class="headerlink" title="net"></a>net</h3><p>1.WARNING: IPv4 forwarding is disabled. Networking will not work.  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim  /usr/lib/sysctl.d/00-system.conf</span><br><span class="line"></span><br><span class="line">添加</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"></span><br><span class="line">重启服务</span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<h3 id="jenkins-1"><a href="#jenkins-1" class="headerlink" title="jenkins"></a>jenkins</h3><p>2.jenkins报错: loaded (/etc/rc.d/init.d/jenkins; bad; vendor preset: disabled)</p>
<blockquote>
<p>凡事尤其原由，若出现了错误日志是最好的提示方式</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.先检查自己的java命令正常不，不正常先处理java，例如下列数据中/usr/bin/java这个命令能不能正常运行，这是jenkins用来运作的一个基础命令，若此命令不可运行，自然会出错</span><br><span class="line">vim /etc/rc.d/init.d/jenkins</span><br><span class="line">//检查文件</span><br><span class="line">candidates="</span><br><span class="line">/etc/alternatives/java</span><br><span class="line">/usr/local/jdk/jdk1.7.0_71/bin/java</span><br><span class="line">/usr/lib/jvm/java-1.8.0/bin/java</span><br><span class="line">/usr/lib/jvm/jre-1.8.0/bin/java</span><br><span class="line">/usr/lib/jvm/java-1.7.0/bin/java</span><br><span class="line">/usr/lib/jvm/jre-1.7.0/bin/java</span><br><span class="line">/usr/bin/java</span><br><span class="line">2.若java命令正常，/usr/bin/java命令也正常再继续看报错或者当前状态</span><br><span class="line">systemctl status jenkins</span><br><span class="line">一句一句读提供的信息</span><br><span class="line">例如我之前便忽略这个信息</span><br><span class="line">Starting Jenkins Jenkins requires Java8 or later, but you are running 1.7.0_71-b14 from /usr/local/jdk/jdk1.7.0_71/jre</span><br><span class="line">jenkins要求jdk1.8,我的配置是jdk1.7=&gt;解决办法是重装jdk,重新运行后成功</span><br></pre></td></tr></table></figure>

<h3 id="mysql远程连接10060"><a href="#mysql远程连接10060" class="headerlink" title="mysql远程连接10060"></a>mysql远程连接10060</h3><p>1.服务是否正常启动</p>
<p>2.端口是否开放，服务器端口，云端口</p>
<p>云端口若为：::/0可以改成0.0.0.0/0试一下</p>
<blockquote>
<p>经检查::/0代表IPV6, 0.0.0.0/0IPV4开放访问</p>
</blockquote>
<p>3.检查授权</p>
<p>use mysql;</p>
<p>select user, host from mysql</p>
<p>更新授权</p>
<h3 id="mvn"><a href="#mvn" class="headerlink" title="mvn"></a>mvn</h3><p>1.问题：</p>
<p> Exception caught: java.util.co<br>ncurrent.ExecutionException: com.spotify.docker.client.shaded.javax.ws.rs.ProcessingException: javax.net.ssl.SSLHandshakeException: sun.security.va<br>lidator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certificati<br>on path to requested target</p>
<p>处理</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">	//增加：</span><br><span class="line">	<span class="tag">&lt;<span class="name">defaultGoal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">defaultGoal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 查询已安装的</span><br><span class="line">rpm -qa| grep mysql</span><br><span class="line">-- 卸载已安装的</span><br><span class="line">rpm -e --nodeps [此处跟你查询出来的mysql-XXX]</span><br></pre></td></tr></table></figure>

<h2 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;jdk1.8.0_171&#x2F;bin&#x2F;java &#x2F;usr&#x2F;bin&#x2F;java</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;jdk1.8.0_171&#x2F;bin&#x2F;javac &#x2F;usr&#x2F;bin&#x2F;javac</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;jdk1.8.0_171&#x2F;bin&#x2F;jar &#x2F;usr&#x2F;bin&#x2F;jar</span><br></pre></td></tr></table></figure>

<h1 id="docker-a-cs"><a href="#docker-a-cs" class="headerlink" title="docker-a-cs"></a>docker-a-cs</h1><h2 id="创建CA秘钥文件夹"><a href="#创建CA秘钥文件夹" class="headerlink" title="创建CA秘钥文件夹"></a>创建CA秘钥文件夹</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/ca</span><br><span class="line">cd /usr/local/ca/</span><br></pre></td></tr></table></figure>

<h2 id="创建密码"><a href="#创建密码" class="headerlink" title="创建密码"></a>创建密码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -aes256 -out ca-key.pem 4096</span><br><span class="line">//提供密码、国家、省、市、组织信息</span><br><span class="line">openssl req -new -x509 -days 365 -key ca-key.pem -sha256 -out ca.pem</span><br><span class="line">[密码]</span><br><span class="line">CN</span><br><span class="line">sx</span><br><span class="line">hz</span><br><span class="line">social</span><br><span class="line">FF</span><br><span class="line">key</span><br><span class="line">1@qq.com</span><br><span class="line">openssl genrsa -out server-key.pem 4096</span><br><span class="line"><span class="meta">//$</span><span class="bash">HOST为服务器外网或域名</span></span><br><span class="line">openssl req -subj "/CN=122.51.8.208" -sha256 -new -key server-key.pem -out server.csr</span><br></pre></td></tr></table></figure>

<h2 id="创建白名单将Docker守护程序密钥的扩展使用属性设置为仅用于服务器身份验"><a href="#创建白名单将Docker守护程序密钥的扩展使用属性设置为仅用于服务器身份验" class="headerlink" title="创建白名单将Docker守护程序密钥的扩展使用属性设置为仅用于服务器身份验"></a>创建白名单将Docker守护程序密钥的扩展使用属性设置为仅用于服务器身份验</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//host,一下命令格式为：IP：HOST,IP:x.x.x.x</span><br><span class="line">echo subjectAltName = IP:122.51.8.208,IP:0.0.0.0&gt;&gt;extfile.cnf</span><br><span class="line">echo extendedKeyUsage = serverAuth &gt;&gt; extfile.cnf</span><br></pre></td></tr></table></figure>

<h2 id="签名证书"><a href="#签名证书" class="headerlink" title="签名证书"></a>签名证书</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 365 -sha256 -in server.csr -CA ca.pem -CAkey ca-key.pem \-CAcreateserial -out server-cert.pem -extfile extfile.cnf</span><br><span class="line">//为客户端生成key</span><br><span class="line">openssl genrsa -out key.pem 4096</span><br><span class="line">//执行</span><br><span class="line">openssl req -subj '/CN=client' -new -key key.pem -out client.csr</span><br><span class="line">echo extendedKeyUsage = clientAuth &gt;&gt; extfile.cnf</span><br><span class="line">//键入密码</span><br><span class="line">openssl x509 -req -days 365 -sha256 -in client.csr -CA ca.pem -CAkey ca-key.pem \-CAcreateserial -out cert.pem -extfile extfile.cnf</span><br></pre></td></tr></table></figure>

<h2 id="清理现场并增加安全性"><a href="#清理现场并增加安全性" class="headerlink" title="清理现场并增加安全性"></a>清理现场并增加安全性</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rm -v client.csr server.csr</span><br><span class="line">//修改文件权限</span><br><span class="line">chmod -v 0400 ca-key.pem key.pem server-key.pem</span><br><span class="line">//证书权限</span><br><span class="line">chmod -v 0444 ca.pem server-cert.pem cert.pem</span><br></pre></td></tr></table></figure>

<h2 id="证书移交至docker"><a href="#证书移交至docker" class="headerlink" title="证书移交至docker"></a>证书移交至docker</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cp server-*.pem  /etc/docker/</span><br><span class="line">//配置</span><br><span class="line">vim /lib/systemd/system/docker.service</span><br><span class="line">//修改ExecStart</span><br><span class="line">ExecStart=/usr/bin/dockerd --tlsverify --tlscacert=/etc/docker/ca.pem --tlscert=/etc/docker/server-cert.pem --tlskey=/etc/docker/server-key.pem -H tcp://0.0.0.0:2376 -H unix:///var/run/docker.sock</span><br><span class="line">//重载</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h2 id="下载证书到本地"><a href="#下载证书到本地" class="headerlink" title="下载证书到本地"></a>下载证书到本地</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ca.pem</span><br><span class="line">cert.pem</span><br><span class="line">key.pem</span><br></pre></td></tr></table></figure>

<h2 id="Idea添加docker认证"><a href="#Idea添加docker认证" class="headerlink" title="Idea添加docker认证"></a>Idea添加docker认证</h2><p>setting-&gt;B,E,D-&gt;Docker-&gt;{url:<a href="https://IP:2376,Cert:本地秘钥}">https://IP:2376,Cert:本地秘钥}</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Alex</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://herycs.github.io/2020/05/24/linux-sw-docker/">https://herycs.github.io/2020/05/24/linux-sw-docker/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/sw/">sw</a><a class="post-meta__tags" href="/tags/docker/">docker</a></div><div class="post_share"><div class="social-share" data-image="/img/post.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/05/24/linux-cmd-chmod/"><img class="prev_cover lazyload" data-src="/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">linux-cmd-chmod</div></div></a></div><div class="next-post pull_right"><a href="/2020/05/24/java-b-Map/"><img class="next_cover lazyload" data-src="/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">java-b-Map</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/05/29/linux-sw-vmNet/" title="linux-sw-vmNet"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-29</div><div class="relatedPosts_title">linux-sw-vmNet</div></div></a></div><div class="relatedPosts_item"><a href="/2019/05/23/linux-#-develop1/" title="linux-#-develop1.md"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-05-23</div><div class="relatedPosts_title">linux-#-develop1.md</div></div></a></div><div class="relatedPosts_item"><a href="/2018/06/21/linux-a-cmd/" title="linux-a-cmd.md"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-06-21</div><div class="relatedPosts_title">linux-a-cmd.md</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/24/linux-cmd-chmod/" title="linux-cmd-chmod"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-24</div><div class="relatedPosts_title">linux-cmd-chmod</div></div></a></div><div class="relatedPosts_item"><a href="/2019/11/23/linux-cmd-top/" title="linux-cmd-top.md"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-11-23</div><div class="relatedPosts_title">linux-cmd-top.md</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Alex</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>