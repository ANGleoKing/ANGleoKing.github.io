<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>mysql-b-note1.md | Alex</title><meta name="description" content="mysql-b-note1.md"><meta name="keywords" content="mysql"><meta name="author" content="Alex"><meta name="copyright" content="Alex"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="mysql-b-note1.md"><meta name="twitter:description" content="mysql-b-note1.md"><meta name="twitter:image" content="https://herycs.github.io/img/post.jpg"><meta property="og:type" content="article"><meta property="og:title" content="mysql-b-note1.md"><meta property="og:url" content="https://herycs.github.io/2018/06/08/mysql-b-note1/"><meta property="og:site_name" content="Alex"><meta property="og:description" content="mysql-b-note1.md"><meta property="og:image" content="https://herycs.github.io/img/post.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://herycs.github.io/2018/06/08/mysql-b-note1/"><link rel="prev" title="linux-a-cmd.md" href="https://herycs.github.io/2018/06/21/linux-a-cmd/"><link rel="next" title="mysql-a-crud.md" href="https://herycs.github.io/2018/03/24/mysql-a-crud/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">35</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">15</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/documents"><i class="fa-fw fa fa-music"></i><span> Documents</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Mysql-数据库应用与开发——笔记1"><span class="toc-number">1.</span> <span class="toc-text">Mysql 数据库应用与开发——笔记1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-基础类型"><span class="toc-number">2.</span> <span class="toc-text">1.基础类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1基本字符集"><span class="toc-number">2.1.</span> <span class="toc-text">1.1基本字符集</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-基本操作"><span class="toc-number">3.</span> <span class="toc-text">2.基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1mysql基本数据库了解"><span class="toc-number">3.1.</span> <span class="toc-text">2.1mysql基本数据库了解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2数据库设计"><span class="toc-number">3.2.</span> <span class="toc-text">2.2数据库设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3数据库创建管理"><span class="toc-number">3.3.</span> <span class="toc-text">2.3数据库创建管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4存储引擎"><span class="toc-number">3.4.</span> <span class="toc-text">2.4存储引擎</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-表和数据完整性"><span class="toc-number">4.</span> <span class="toc-text">3.表和数据完整性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1数据库表管理"><span class="toc-number">4.1.</span> <span class="toc-text">3.1数据库表管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2表数据操作"><span class="toc-number">4.2.</span> <span class="toc-text">3.2表数据操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3表完整性"><span class="toc-number">4.3.</span> <span class="toc-text">3.3表完整性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-数据检索"><span class="toc-number">5.</span> <span class="toc-text">4.数据检索</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1基本查询"><span class="toc-number">5.1.</span> <span class="toc-text">4.1基本查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2单表查询"><span class="toc-number">5.2.</span> <span class="toc-text">4.2单表查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3聚合函数查询"><span class="toc-number">5.3.</span> <span class="toc-text">4.3聚合函数查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4多表连接"><span class="toc-number">5.4.</span> <span class="toc-text">4.4多表连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5子查询"><span class="toc-number">5.5.</span> <span class="toc-text">4.5子查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6正则表达式模糊查询"><span class="toc-number">5.6.</span> <span class="toc-text">4.6正则表达式模糊查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-索引视图"><span class="toc-number">6.</span> <span class="toc-text">5.索引视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1索引"><span class="toc-number">6.1.</span> <span class="toc-text">5.1索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2视图"><span class="toc-number">6.2.</span> <span class="toc-text">5.2视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3视图应用"><span class="toc-number">6.3.</span> <span class="toc-text">5.3视图应用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-基础操作"><span class="toc-number">7.</span> <span class="toc-text">6.基础操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1基础编程"><span class="toc-number">7.1.</span> <span class="toc-text">6.1基础编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2自定义函数"><span class="toc-number">7.2.</span> <span class="toc-text">6.2自定义函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1创建函数"><span class="toc-number">7.2.1.</span> <span class="toc-text">6.2.1创建函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2使用函数"><span class="toc-number">7.2.2.</span> <span class="toc-text">6.2.2使用函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3查看函数"><span class="toc-number">7.2.3.</span> <span class="toc-text">6.2.3查看函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4修改函数"><span class="toc-number">7.2.4.</span> <span class="toc-text">6.2.4修改函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-5删除函数定义"><span class="toc-number">7.2.5.</span> <span class="toc-text">6.2.5删除函数定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3控制流语句"><span class="toc-number">7.3.</span> <span class="toc-text">6.3控制流语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1-if"><span class="toc-number">7.3.1.</span> <span class="toc-text">6.3.1 if</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2-case"><span class="toc-number">7.3.2.</span> <span class="toc-text">6.3.2 case</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-3-条件判断函数"><span class="toc-number">7.3.3.</span> <span class="toc-text">6.3.3 条件判断函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4循环语句"><span class="toc-number">7.4.</span> <span class="toc-text">6.4循环语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-1-while"><span class="toc-number">7.4.1.</span> <span class="toc-text">6.4.1 while</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-2-loop"><span class="toc-number">7.4.2.</span> <span class="toc-text">6.4.2 loop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-3-repeat"><span class="toc-number">7.4.3.</span> <span class="toc-text">6.4.3 repeat</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-存储过程，游标，触发器"><span class="toc-number">8.</span> <span class="toc-text">7.存储过程，游标，触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1存储过程"><span class="toc-number">8.1.</span> <span class="toc-text">7.1存储过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2游标处理结果集"><span class="toc-number">8.2.</span> <span class="toc-text">7.2游标处理结果集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3触发器"><span class="toc-number">8.3.</span> <span class="toc-text">7.3触发器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4事件及应用"><span class="toc-number">8.4.</span> <span class="toc-text">7.4事件及应用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-并发事务与锁"><span class="toc-number">9.</span> <span class="toc-text">8.并发事务与锁</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1事务"><span class="toc-number">9.1.</span> <span class="toc-text">8.1事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1事务管理"><span class="toc-number">9.2.</span> <span class="toc-text">8.1事务管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2事务并发"><span class="toc-number">9.3.</span> <span class="toc-text">8.2事务并发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3管理锁"><span class="toc-number">9.4.</span> <span class="toc-text">8.3管理锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4死锁管理"><span class="toc-number">9.5.</span> <span class="toc-text">8.4死锁管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5注意事项"><span class="toc-number">9.6.</span> <span class="toc-text">8.5注意事项</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-权限管理及控制"><span class="toc-number">10.</span> <span class="toc-text">9.权限管理及控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1mysql权限管理系统原理"><span class="toc-number">10.1.</span> <span class="toc-text">9.1mysql权限管理系统原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-1-mysql权限表"><span class="toc-number">10.1.1.</span> <span class="toc-text">9.1.1 mysql权限表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-2权限工作原理"><span class="toc-number">10.1.2.</span> <span class="toc-text">9.1.2权限工作原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2账户管理"><span class="toc-number">10.2.</span> <span class="toc-text">9.2账户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-1-普通用户管理"><span class="toc-number">10.2.1.</span> <span class="toc-text">9.2.1 普通用户管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-2-登录及修改密码"><span class="toc-number">10.2.2.</span> <span class="toc-text">9.2.2 登录及修改密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3权限管理"><span class="toc-number">10.3.</span> <span class="toc-text">9.3权限管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4数据库安全常见问题"><span class="toc-number">10.4.</span> <span class="toc-text">9.4数据库安全常见问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-备份与恢复"><span class="toc-number">11.</span> <span class="toc-text">10.备份与恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1备份，恢复概述"><span class="toc-number">11.1.</span> <span class="toc-text">10.1备份，恢复概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2数据备份"><span class="toc-number">11.2.</span> <span class="toc-text">10.2数据备份</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3数据恢复"><span class="toc-number">11.3.</span> <span class="toc-text">10.3数据恢复</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4数据库迁移"><span class="toc-number">11.4.</span> <span class="toc-text">10.4数据库迁移</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-5表的导入与导出"><span class="toc-number">11.5.</span> <span class="toc-text">10.5表的导入与导出</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-性能优化"><span class="toc-number">12.</span> <span class="toc-text">11.性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1优化数据库服务器"><span class="toc-number">12.1.</span> <span class="toc-text">11.1优化数据库服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2优化查询"><span class="toc-number">12.2.</span> <span class="toc-text">11.2优化查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-1分析查询语句"><span class="toc-number">12.2.1.</span> <span class="toc-text">11.2.1分析查询语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-2使用索引优化查询"><span class="toc-number">12.2.2.</span> <span class="toc-text">11.2.2使用索引优化查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-3优化多表查询"><span class="toc-number">12.2.3.</span> <span class="toc-text">11.2.3优化多表查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3优化数据结构"><span class="toc-number">12.3.</span> <span class="toc-text">11.3优化数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-1优化表结构"><span class="toc-number">12.3.1.</span> <span class="toc-text">11.3.1优化表结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-2增加中间表"><span class="toc-number">12.3.2.</span> <span class="toc-text">11.3.2增加中间表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-3优化插入记录速度"><span class="toc-number">12.3.3.</span> <span class="toc-text">11.3.3优化插入记录速度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-4分析表，检查表和优化表"><span class="toc-number">12.3.4.</span> <span class="toc-text">11.3.4分析表，检查表和优化表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-5优化慢查询"><span class="toc-number">12.3.5.</span> <span class="toc-text">11.3.5优化慢查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-6优化表设计"><span class="toc-number">12.3.6.</span> <span class="toc-text">11.3.6优化表设计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-4查询高速缓存"><span class="toc-number">12.4.</span> <span class="toc-text">11.4查询高速缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-5优化性能的其它方面"><span class="toc-number">12.5.</span> <span class="toc-text">11.5优化性能的其它方面</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-日志文件管理"><span class="toc-number">13.</span> <span class="toc-text">12.日志文件管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1错误日志"><span class="toc-number">13.1.</span> <span class="toc-text">12.1错误日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2二进制日志"><span class="toc-number">13.2.</span> <span class="toc-text">12.2二进制日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3通用查询日志"><span class="toc-number">13.3.</span> <span class="toc-text">12.3通用查询日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-4慢查询日志"><span class="toc-number">13.4.</span> <span class="toc-text">12.4慢查询日志</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/post.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Alex</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/documents"><i class="fa-fw fa fa-music"></i><span> Documents</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">mysql-b-note1.md</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2018-06-08 19:25:58"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2018-06-08</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2018-06-08 19:25:58"><i class="fa fa-history" aria-hidden="true"></i> Updated 2018-06-08</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/db/">db</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="Mysql-数据库应用与开发——笔记1"><a href="#Mysql-数据库应用与开发——笔记1" class="headerlink" title="Mysql 数据库应用与开发——笔记1"></a>Mysql 数据库应用与开发——笔记1</h1><h1 id="1-基础类型"><a href="#1-基础类型" class="headerlink" title="1.基础类型"></a>1.基础类型</h1><h2 id="1-1基本字符集"><a href="#1-1基本字符集" class="headerlink" title="1.1基本字符集"></a>1.1基本字符集</h2><p>1.1.1查看</p>
<blockquote>
<p>查看所有字符集</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="built_in">character</span> <span class="keyword">set</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看校对原则</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">collation</span> <span class="keyword">like</span> <span class="string">'latin1%'</span>;</span><br></pre></td></tr></table></figure>

<p>1.2数据类型</p>
<p>1.3运算符、表达式</p>
<p>1.4常用函数</p>
<h1 id="2-基本操作"><a href="#2-基本操作" class="headerlink" title="2.基本操作"></a>2.基本操作</h1><h2 id="2-1mysql基本数据库了解"><a href="#2-1mysql基本数据库了解" class="headerlink" title="2.1mysql基本数据库了解"></a>2.1mysql基本数据库了解</h2><h2 id="2-2数据库设计"><a href="#2-2数据库设计" class="headerlink" title="2.2数据库设计"></a>2.2数据库设计</h2><h2 id="2-3数据库创建管理"><a href="#2-3数据库创建管理" class="headerlink" title="2.3数据库创建管理"></a>2.3数据库创建管理</h2><h2 id="2-4存储引擎"><a href="#2-4存储引擎" class="headerlink" title="2.4存储引擎"></a>2.4存储引擎</h2><h1 id="3-表和数据完整性"><a href="#3-表和数据完整性" class="headerlink" title="3.表和数据完整性"></a>3.表和数据完整性</h1><h2 id="3-1数据库表管理"><a href="#3-1数据库表管理" class="headerlink" title="3.1数据库表管理"></a>3.1数据库表管理</h2><p>3.1.1存储引擎表空间</p>
<p>3.1.2表操作</p>
<p>3.1.3临时表管理</p>
<h2 id="3-2表数据操作"><a href="#3-2表数据操作" class="headerlink" title="3.2表数据操作"></a>3.2表数据操作</h2><h2 id="3-3表完整性"><a href="#3-3表完整性" class="headerlink" title="3.3表完整性"></a>3.3表完整性</h2><p>3.3.1非空</p>
<p>3.3.2主键</p>
<p>3.3.3外键</p>
<p>3.3.4检查约束</p>
<p>3.3.5唯一性约束</p>
<h1 id="4-数据检索"><a href="#4-数据检索" class="headerlink" title="4.数据检索"></a>4.数据检索</h1><h2 id="4-1基本查询"><a href="#4-1基本查询" class="headerlink" title="4.1基本查询"></a>4.1基本查询</h2><h2 id="4-2单表查询"><a href="#4-2单表查询" class="headerlink" title="4.2单表查询"></a>4.2单表查询</h2><h2 id="4-3聚合函数查询"><a href="#4-3聚合函数查询" class="headerlink" title="4.3聚合函数查询"></a>4.3聚合函数查询</h2><h2 id="4-4多表连接"><a href="#4-4多表连接" class="headerlink" title="4.4多表连接"></a>4.4多表连接</h2><h2 id="4-5子查询"><a href="#4-5子查询" class="headerlink" title="4.5子查询"></a>4.5子查询</h2><h2 id="4-6正则表达式模糊查询"><a href="#4-6正则表达式模糊查询" class="headerlink" title="4.6正则表达式模糊查询"></a>4.6正则表达式模糊查询</h2><blockquote>
<p>语法格式：select…from where … regexp “”;</p>
</blockquote>
<table>
<thead>
<tr>
<th>匹配符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>^</td>
<td>匹配文本开始字符</td>
</tr>
<tr>
<td>$</td>
<td>匹配文本结束字符</td>
</tr>
<tr>
<td>.</td>
<td>匹配任何单个字符</td>
</tr>
<tr>
<td>*</td>
<td>匹配0或多个在它前面的字符</td>
</tr>
<tr>
<td>+</td>
<td>匹配前面的字符1或多次</td>
</tr>
<tr>
<td>&lt;&gt;</td>
<td>匹配指定的字符串</td>
</tr>
<tr>
<td>[]</td>
<td>匹配字符集合中的任意一个</td>
</tr>
<tr>
<td>{n,}</td>
<td>匹配前面的字符串至少n次</td>
</tr>
<tr>
<td>{m,n}</td>
<td>匹配前面的字符串至少m次，至多n次</td>
</tr>
<tr>
<td>[^]</td>
<td>匹配不在括号中的任何字符</td>
</tr>
</tbody></table>
<ul>
<li><p>示例</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> scc <span class="keyword">where</span> Sno regexp <span class="string">"21$"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> scc <span class="keyword">where</span> Sno regexp <span class="string">"^20"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> scc <span class="keyword">where</span> Sno regexp <span class="string">".15122"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> scc <span class="keyword">where</span> Sno regexp <span class="string">"[12151]"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> scc <span class="keyword">where</span> Sno regexp <span class="string">"[^12151]"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> scc <span class="keyword">where</span> Sno regexp <span class="string">"1&#123;2,&#125;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> scc <span class="keyword">where</span> Sno regexp <span class="string">"2&#123;1,2&#125;"</span>;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h1 id="5-索引视图"><a href="#5-索引视图" class="headerlink" title="5.索引视图"></a>5.索引视图</h1><h2 id="5-1索引"><a href="#5-1索引" class="headerlink" title="5.1索引"></a>5.1索引</h2><h2 id="5-2视图"><a href="#5-2视图" class="headerlink" title="5.2视图"></a>5.2视图</h2><h2 id="5-3视图应用"><a href="#5-3视图应用" class="headerlink" title="5.3视图应用"></a>5.3视图应用</h2><h1 id="6-基础操作"><a href="#6-基础操作" class="headerlink" title="6.基础操作"></a>6.基础操作</h1><h2 id="6-1基础编程"><a href="#6-1基础编程" class="headerlink" title="6.1基础编程"></a>6.1基础编程</h2><p>6.1.1自定义变量</p>
<ul>
<li>定义用户变量set或select</li>
</ul>
<blockquote>
<p>使用区别：</p>
<p>set @value_name = (select * from table__name);</p>
<p>select @ value_name := (select * from table_name);</p>
</blockquote>
<p>6.1.2局部变量</p>
<ul>
<li>declare 声明局部变量</li>
</ul>
<blockquote>
<p>示例：</p>
<p>declare value_demo1 int default 100;</p>
</blockquote>
<ul>
<li>局部变量的范围仅限于存储程序中（函数，触发器，存储过程等），且在使用时不可将名称定义为表字段名，否则得不出预期结果</li>
</ul>
<p>6.1.3定界符delimiter</p>
<blockquote>
<p>为了解决遇到 ; 语句就执行的情况</p>
</blockquote>
<ul>
<li><p>使用语法：delimiter 定界符 查询语句 定界符</p>
<p>  示例：delimiter // select * from table_1 //</p>
</li>
</ul>
<p>6.1.4begin…end语句块</p>
<ul>
<li><p>使用：</p>
<p>  begin </p>
<p>  ​    [局部]变量声明;</p>
<p>  ​     程序代码行集;</p>
<p>   end</p>
</li>
</ul>
<p>6.1.5 预处理</p>
<p>6.1.5.1基本语句</p>
<ul>
<li>prepare</li>
<li>execute</li>
<li>deallocate</li>
</ul>
<p>6.1.5.2使用步骤</p>
<ul>
<li>创建</li>
<li>使用</li>
<li>释放</li>
</ul>
<h2 id="6-2自定义函数"><a href="#6-2自定义函数" class="headerlink" title="6.2自定义函数"></a>6.2自定义函数</h2><h3 id="6-2-1创建函数"><a href="#6-2-1创建函数" class="headerlink" title="6.2.1创建函数"></a>6.2.1创建函数</h3><blockquote>
<p>修改结束认定符以避免函数返回语句后的分号被认定为结束符，从而语句被执行产生错误</p>
<p>1.创建函数需写出函数名、函数参数、函数返回值类型</p>
<p>2.在begin…end语句中编写函数的具体执行内容</p>
<p>最终为符合常规执行sql语句的习惯，将结束认定符修改回分号</p>
</blockquote>
<ul>
<li>创建示例</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.修改结束符为其它符号</span><br><span class="line">delimiter //</span><br><span class="line"></span><br><span class="line">2.创建函数</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> function_name(val_1 <span class="built_in">int</span>, val_2 <span class="built_in">int</span>) <span class="keyword">returns</span> <span class="built_in">char</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">return</span> val_1 * val_2;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="number">3.</span>结束创建</span><br><span class="line">//</span><br><span class="line"><span class="number">4.</span>修改结束认定符为;</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-2使用函数"><a href="#6-2-2使用函数" class="headerlink" title="6.2.2使用函数"></a>6.2.2使用函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select function_name(12, 13);</span><br></pre></td></tr></table></figure>

<h3 id="6-2-3查看函数"><a href="#6-2-3查看函数" class="headerlink" title="6.2.3查看函数"></a>6.2.3查看函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">查看指定数据库中的所有自定义函数</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">function</span> <span class="keyword">status</span>;(函数少时使用)</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">function</span> <span class="keyword">status</span> <span class="keyword">like</span> 模式;(函数多时使用)</span><br><span class="line"></span><br><span class="line">查看指定数据库中所有自定义函数名</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> MySQL.proc </span><br><span class="line"><span class="keyword">where</span> db=<span class="string">'course'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'function'</span>;</span><br><span class="line"></span><br><span class="line">查看指定函数名的详细信息</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">function</span> function_name;</span><br><span class="line"></span><br><span class="line">函数信息保存在information_schema数据库中的routines表中</span><br><span class="line">检索表可查看相关函数信息</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.routines</span><br><span class="line">	<span class="keyword">where</span> routine_name = <span class="string">'function_name'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-4修改函数"><a href="#6-2-4修改函数" class="headerlink" title="6.2.4修改函数"></a>6.2.4修改函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">格式</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">function</span> func_name[<span class="keyword">characters</span> -]</span><br></pre></td></tr></table></figure>

<h3 id="6-2-5删除函数定义"><a href="#6-2-5删除函数定义" class="headerlink" title="6.2.5删除函数定义"></a>6.2.5删除函数定义</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> func_name;</span><br></pre></td></tr></table></figure>

<h2 id="6-3控制流语句"><a href="#6-3控制流语句" class="headerlink" title="6.3控制流语句"></a>6.3控制流语句</h2><h3 id="6-3-1-if"><a href="#6-3-1-if" class="headerlink" title="6.3.1 if"></a>6.3.1 if</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">格式（其中“[]”中为可选并非使用时要带上 []）</span><br><span class="line">if condition then</span><br><span class="line">...</span><br><span class="line">[else condition then]</span><br><span class="line">...</span><br><span class="line">[else]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="6-3-2-case"><a href="#6-3-2-case" class="headerlink" title="6.3.2 case"></a>6.3.2 case</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">格式</span><br><span class="line">case value</span><br><span class="line">	when vlaue then</span><br><span class="line">	...</span><br><span class="line">	else</span><br><span class="line">	...</span><br><span class="line">end case</span><br></pre></td></tr></table></figure>

<h3 id="6-3-3-条件判断函数"><a href="#6-3-3-条件判断函数" class="headerlink" title="6.3.3 条件判断函数"></a>6.3.3 条件判断函数</h3><ul>
<li><p>if()</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (condition , v1, v2)</span><br><span class="line">condition为true,返回 v1, 否则返回v2</span><br></pre></td></tr></table></figure>
</li>
<li><p>ifnull()</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifnull(v1, v2)</span><br><span class="line">从v1开始，返回第一个不为null的值</span><br></pre></td></tr></table></figure>
</li>
<li><p>case</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case 表达式1</span><br><span class="line">when 值1 = 条件1 then 结果1</span><br><span class="line">when 值2 = 条件2 then 结果2</span><br><span class="line">else 其他值</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="6-4循环语句"><a href="#6-4循环语句" class="headerlink" title="6.4循环语句"></a>6.4循环语句</h2><h3 id="6-4-1-while"><a href="#6-4-1-while" class="headerlink" title="6.4.1 while"></a>6.4.1 while</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">while condition <span class="keyword">do</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">while</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-2-loop"><a href="#6-4-2-loop" class="headerlink" title="6.4.2 loop"></a>6.4.2 loop</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">loop</span><br><span class="line">...</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">loop</span></span><br></pre></td></tr></table></figure>

<h3 id="6-4-3-repeat"><a href="#6-4-3-repeat" class="headerlink" title="6.4.3 repeat"></a>6.4.3 repeat</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repeat</span><br><span class="line">...</span><br><span class="line">until condition</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">repeat</span></span><br></pre></td></tr></table></figure>

<h1 id="7-存储过程，游标，触发器"><a href="#7-存储过程，游标，触发器" class="headerlink" title="7.存储过程，游标，触发器"></a>7.存储过程，游标，触发器</h1><h2 id="7-1存储过程"><a href="#7-1存储过程" class="headerlink" title="7.1存储过程"></a>7.1存储过程</h2><p>7.1.1创建存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">存储过程有三类参数，in(输入), out(输出), inout(输入输出)</span><br><span class="line"><span class="keyword">create</span> produce <span class="keyword">name</span>(params);</span><br></pre></td></tr></table></figure>

<p>7.1.2调用存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> [db.name]sp_name(params);</span><br></pre></td></tr></table></figure>

<p>7.1.3查看定义</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> produce <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'do_%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> produce <span class="keyword">do</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.routines <span class="keyword">where</span> routine_name = <span class="string">'do'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> produce <span class="keyword">do</span>;</span><br></pre></td></tr></table></figure>

<p>7.1.4条件和处理程序定义</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">定义条件</span><br><span class="line"><span class="keyword">declare</span> condition_name condition <span class="keyword">for</span> condition_type;</span><br><span class="line">condition_type:</span><br><span class="line">sqlstate [value] sqlstate_value|mysql_error_code</span><br><span class="line"><span class="comment">-- condition_name：错误触发条件的名称</span></span><br><span class="line"><span class="comment">-- condition_type:条件类型，MySQL错误代码，ANSI标准错误代码</span></span><br><span class="line">				sqlstate_value是长度为5的字符串类型错误代码</span><br><span class="line">				mysql_error_code数值类型错误代码</span><br><span class="line">				</span><br><span class="line">定义处理程序</span><br><span class="line"><span class="keyword">declare</span> handler_type <span class="keyword">handler</span> <span class="keyword">for</span> condition_value[] sp_statement handler_type:</span><br><span class="line">continue|<span class="keyword">exit</span></span><br><span class="line">condition_value:</span><br><span class="line"><span class="keyword">sqlstate</span> [<span class="keyword">value</span>]sqlstate_value|condition_name|sqlwarning|<span class="keyword">not</span> <span class="keyword">found</span>|sqlexception|mysql_error_code</span><br><span class="line"><span class="comment">-- handler_type: 错误处理类型</span></span><br><span class="line">				continue发生错误不处理，执行其他语句</span><br><span class="line">				<span class="keyword">exit</span>发生错误退出<span class="keyword">sql</span>语句的执行</span><br><span class="line"><span class="comment">-- condition_value:错误触发条件</span></span><br><span class="line">				<span class="keyword">sqlstate</span>[<span class="keyword">value</span>]sqlstate_value:长度为<span class="number">5</span>自UC哈UN类型错误代码</span><br><span class="line">				condition_value:定义的错误条件名称</span><br><span class="line">				sqlwarning:匹配所有<span class="number">01</span>开头的<span class="keyword">sqlstate</span>错误代码</span><br><span class="line">				<span class="keyword">not</span> <span class="keyword">found</span>:匹配所有<span class="number">02</span>开头的<span class="keyword">sqlstate</span>错误代码</span><br><span class="line">				sqlexception:匹配其它非sqlwarning和<span class="keyword">not</span> <span class="keyword">found</span>捕获的错误代码</span><br><span class="line">				mysql_error_code:数值型错误代码</span><br><span class="line"><span class="comment">-- sp_statement:自定义错误处理程序</span></span><br></pre></td></tr></table></figure>

<p>7.1.5修改存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">修改参数</span><br><span class="line"><span class="keyword">alter</span> produce sp_name[characteristic ...]</span><br><span class="line"></span><br><span class="line">修改权限</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">procedure</span> do_name modifies <span class="keyword">sql</span> <span class="keyword">data</span> <span class="keyword">sql</span> <span class="keyword">security</span> invoker;</span><br></pre></td></tr></table></figure>

<p>7.1.6删除存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> produce[<span class="keyword">if</span> exits] sp_name</span><br></pre></td></tr></table></figure>

<h2 id="7-2游标处理结果集"><a href="#7-2游标处理结果集" class="headerlink" title="7.2游标处理结果集"></a>7.2游标处理结果集</h2><blockquote>
<p>流程：声明游标-&gt;打开游标-&gt;提取数据，处理数据-&gt;关闭游标</p>
</blockquote>
<p>7.2.1声明游标</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> cursor_name <span class="keyword">cursor</span> <span class="keyword">for</span> select_statement;</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"><span class="keyword">declare</span> teach_cursor <span class="keyword">cursor</span></span><br><span class="line">	<span class="keyword">for</span> <span class="keyword">select</span> <span class="keyword">name</span>, age <span class="keyword">from</span> students;</span><br></pre></td></tr></table></figure>

<p>7.2.2打开游标</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open cursor_name;</span><br></pre></td></tr></table></figure>

<p>7.2.3游标中提取数据</p>
<blockquote>
<p>注意：</p>
<p>变量，需要与声明时的变量名个数一致</p>
<p>fetch语句，</p>
<p>​        每次只能提取一条语句，因此想便利整个结果集需要与循环语句结合</p>
<p>​        fetch提取完最后一条语句之后，再次提取结果集会</p>
<p>​                报{ERROR 1329(0200)}错</p>
<p>游标错误处理程序应当写在游标声明语句之后，通常两者结合结束结果集的遍历        </p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch cursor_name into var1[,var2,..]</span><br></pre></td></tr></table></figure>

<p>7.2.4关闭游标</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">close cursor_name</span><br></pre></td></tr></table></figure>

<h2 id="7-3触发器"><a href="#7-3触发器" class="headerlink" title="7.3触发器"></a>7.3触发器</h2><p>7.3.1触发器建立</p>
<blockquote>
<p>触发器执行顺序，before，执行操作，after</p>
<p>触发器中可以使用old,new关键字</p>
<p>​    old代表语句执行的前的数据只读，只可引用，不可更改</p>
<p>​    new代表语句执行后的数据</p>
<p>对于insert 只有new是合法的</p>
<p>对于delete 只有old是合法的</p>
<p>对于update old和new都合法</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> trigger_name trigger_time trigger_event <span class="keyword">on</span> table_name <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span> trigger_statement</span><br><span class="line"></span><br><span class="line"><span class="comment">-- tbale_name:触发程序相关表</span></span><br><span class="line"><span class="comment">-- trigger_time:触发动作时间</span></span><br><span class="line"><span class="comment">-- trigger_event:激活触发器的语句类型，不支持同一个表中同时存在两个相同的激活触发的类型</span></span><br><span class="line">	<span class="keyword">insert</span></span><br><span class="line">	<span class="keyword">update</span></span><br><span class="line">	<span class="keyword">delete</span></span><br><span class="line"><span class="comment">-- for each row:声明由触发器激活的每一行都要激活触发器的动作</span></span><br><span class="line"><span class="comment">-- trigger_statement:触发程序激活时执行的语句</span></span><br></pre></td></tr></table></figure>

<p>7.3.2触发器注意事项</p>
<ul>
<li>触发器中select语句不能返回结果集</li>
<li>同一个表不能创建两个相同触发时间触发时间的触发程序</li>
<li>触发程序中不能使用显式或隐式方式打开、开始和结束事务</li>
<li>批量更新数据触发器会降低更新效率</li>
<li>MyISAM中触发器不能保证原子性</li>
<li>InnoDB中建议级联维护外键数据，MyISAM中使用触发器实现级联修改删除</li>
<li>使用触发器维护InnoDB 维护数据，先维护父表再维护子表</li>
<li>mysql触发器中不可对本表使用更新语句，可使用set命令代替</li>
<li>before 中auto_increment字段的new值为0不是插入操作自动生成的自增型字段值</li>
<li>添加触发器建议进行详细测试</li>
</ul>
<p>7.3.3删除触发器</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span>[schema.]trigger_name</span><br></pre></td></tr></table></figure>

<h2 id="7-4事件及应用"><a href="#7-4事件及应用" class="headerlink" title="7.4事件及应用"></a>7.4事件及应用</h2><p>7.4.1认识事件调度</p>
<ul>
<li><p>开启事件调度</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @@global.event_scheduler = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">在mysql配置文件my.ini中加入 event_scheduler = 1;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看事件</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'event_scheduler'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> @@event_scheduler</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>7.4.2使用事件</p>
<ul>
<li><p>创建</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">event</span> [<span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span>] event_name <span class="keyword">on</span> schedule schedule [<span class="keyword">on</span> completion[noe <span class="keyword">preserve</span>]] [<span class="keyword">enable</span>|<span class="keyword">disable</span>|<span class="keyword">disable</span> <span class="keyword">on</span> <span class="keyword">slave</span>] [<span class="keyword">comment</span><span class="string">'comment'</span>] <span class="keyword">do</span> sql_statement;</span><br><span class="line"><span class="comment">-- event_name: 事件名</span></span><br><span class="line"><span class="comment">-- schdeule:时间调度</span></span><br><span class="line">	at子句：事件在某个时刻发生</span><br><span class="line">		timestamp具体一个时间点</span><br><span class="line">	every子句：在指定时间区间内每隔多长时间发生一次</span><br><span class="line">		starts开始时间，ends结束时间</span><br><span class="line"><span class="comment">-- do sql_statement:事件启动时执行SQL代码</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>管理事件</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">events</span> [<span class="keyword">from</span> schema_name] [<span class="keyword">like</span> <span class="string">'pattern'</span>|<span class="keyword">where</span> expr]</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">events</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> evetns\G;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">event</span> event_name;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改事件</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">event</span> event_name [<span class="keyword">on</span> schedule schedule]</span><br><span class="line">[<span class="keyword">rename</span> <span class="keyword">to</span> new_name] <span class="keyword">on</span> completion[<span class="keyword">not</span>] <span class="keyword">preserve</span>]</span><br><span class="line">[<span class="keyword">comment</span><span class="string">'comment'</span>][<span class="keyword">enable</span>|<span class="keyword">disable</span>][db sql_statement]</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除事件</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">event</span>[<span class="keyword">if</span> <span class="keyword">exists</span>][<span class="keyword">database</span> name.]event_name</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="8-并发事务与锁"><a href="#8-并发事务与锁" class="headerlink" title="8.并发事务与锁"></a>8.并发事务与锁</h1><h2 id="8-1事务"><a href="#8-1事务" class="headerlink" title="8.1事务"></a>8.1事务</h2><p>8.1.1特性</p>
<ul>
<li><p>原子性</p>
</li>
<li><p>一致性</p>
</li>
<li><p>隔离性</p>
</li>
<li><p>持久性</p>
</li>
</ul>
<p>8.1.2事务分类</p>
<ul>
<li>自动提交事务</li>
<li>用户定义事务</li>
<li>分布式事务</li>
</ul>
<h2 id="8-1事务管理"><a href="#8-1事务管理" class="headerlink" title="8.1事务管理"></a>8.1事务管理</h2><p>8.1.1关闭自动提交事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @@autocomit = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>8.1.2启动事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>|<span class="keyword">begin</span> <span class="keyword">work</span></span><br></pre></td></tr></table></figure>

<p>8.1.3结束事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">commit</span> [<span class="keyword">work</span>][<span class="keyword">and</span>[<span class="keyword">no</span>]<span class="keyword">chain</span>] [[<span class="keyword">no</span>] <span class="keyword">release</span>]</span><br></pre></td></tr></table></figure>

<p>8.1.4回滚事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">rollback</span> [<span class="keyword">work</span>][<span class="keyword">and</span>[<span class="keyword">no</span>]<span class="keyword">chain</span>] [[<span class="keyword">no</span>] <span class="keyword">release</span>]</span><br></pre></td></tr></table></figure>

<p>8.1.5设置事务检查点</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">savepoint</span> identifier</span><br><span class="line"><span class="comment">-- identfier:检查点名称</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rollback</span> [<span class="keyword">work</span>] <span class="keyword">to</span> <span class="keyword">savepoint</span> identifer</span><br><span class="line"><span class="comment">-- 事务回滚到某个保存点，该保存点后的保存点会被删除</span></span><br></pre></td></tr></table></figure>

<h2 id="8-2事务并发"><a href="#8-2事务并发" class="headerlink" title="8.2事务并发"></a>8.2事务并发</h2><p>8.2.1设置事务隔离级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> &#123;<span class="keyword">global</span>|<span class="keyword">session</span>&#125; <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span>&#123;<span class="keyword">read</span> uncommitted|<span class="keyword">read</span> committed|repeatable <span class="keyword">read</span>|<span class="keyword">serializable</span>&#125;</span><br></pre></td></tr></table></figure>

<p>8.2.2获取当前隔离级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @@tx_isolation</span><br></pre></td></tr></table></figure>

<h2 id="8-3管理锁"><a href="#8-3管理锁" class="headerlink" title="8.3管理锁"></a>8.3管理锁</h2><p>8.3.1锁的了解</p>
<ul>
<li>锁的粒度</li>
<li>隐式和显式锁</li>
<li>锁的类型</li>
<li>锁的钥匙</li>
<li>锁的生命周期</li>
</ul>
<p>8.3.2锁定与解锁</p>
<ul>
<li><p>锁定表</p>
<blockquote>
<p>对一个事务使用表锁定机制时，会隐式的提交所有事务，开始一个事务时会解开所有表锁定，事务表中@@autocommit必须设定为0，否则会在执行后立刻释放表锁定，会造成死锁</p>
</blockquote>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lock</span> <span class="keyword">tables</span> tbale_name[<span class="keyword">as</span> <span class="keyword">alias</span>]&#123;<span class="keyword">read</span>[<span class="keyword">local</span>]|[<span class="keyword">low_priority</span>]write&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>解锁表</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unlock</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>8.3.3锁分类</p>
<p>8.3.3.1表锁</p>
<ul>
<li><p>读锁</p>
</li>
<li><p>写锁</p>
</li>
</ul>
<p>8.3.3.2行锁</p>
<ul>
<li>排他锁</li>
<li>共享锁</li>
<li>意向锁<ul>
<li>意向共享锁</li>
<li>意向排它锁</li>
</ul>
</li>
</ul>
<p>8.3.3.3页锁</p>
<h2 id="8-4死锁管理"><a href="#8-4死锁管理" class="headerlink" title="8.4死锁管理"></a>8.4死锁管理</h2><ul>
<li>一般将较小的事务进行回滚，让较大锁完成任务</li>
</ul>
<h2 id="8-5注意事项"><a href="#8-5注意事项" class="headerlink" title="8.5注意事项"></a>8.5注意事项</h2><ul>
<li>锁粒度越小，并发性能要求越高</li>
<li>事务中，避免一个事务中使用不同引擎的表</li>
<li>处理事务时选择设置和使用较低的隔离级别</li>
<li>尽量使用行锁控制的隔离级别</li>
<li>InnoDB支持的行锁，设置合理的超时参数范围，编写锁等待超时异常处理程序解决锁等待问题</li>
<li>多记录修改，获取所有表的排他锁之后再执行修改操作</li>
<li>缩短锁的生命周期</li>
<li>事务中尽量按照一定顺序访问数据库对象</li>
</ul>
<h1 id="9-权限管理及控制"><a href="#9-权限管理及控制" class="headerlink" title="9.权限管理及控制"></a>9.权限管理及控制</h1><h2 id="9-1mysql权限管理系统原理"><a href="#9-1mysql权限管理系统原理" class="headerlink" title="9.1mysql权限管理系统原理"></a>9.1mysql权限管理系统原理</h2><h3 id="9-1-1-mysql权限表"><a href="#9-1-1-mysql权限表" class="headerlink" title="9.1.1 mysql权限表"></a>9.1.1 mysql权限表</h3><p>9.1.1.1 user表</p>
<ul>
<li><p>查看mysql数据库提供的权限管理</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> mysql;</span><br><span class="line"></span><br><span class="line">desc user;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>9.1.1.2 db表和host表</p>
<ul>
<li>db表存储用户对某个数据库的操作权限，决定用户可以从哪个主机存取某个数据库</li>
<li>host表存储主机对数据库的操作权限，不受grant和revoke影响</li>
</ul>
<p>9.1.1.3 tables_priv表和column_priv表</p>
<ul>
<li>tables_priv对单个表进行权限控制</li>
<li>column_priv对表的操作权限</li>
</ul>
<p>9.1.1.4 procs_priv表</p>
<blockquote>
<p>对存储过程及存储权限进行控制</p>
</blockquote>
<h3 id="9-1-2权限工作原理"><a href="#9-1-2权限工作原理" class="headerlink" title="9.1.2权限工作原理"></a>9.1.2权限工作原理</h3><p>9.1.2.1连接核实</p>
<blockquote>
<p>基于用户提供信息验证用户身份</p>
</blockquote>
<p>9.1.2.2请求核实</p>
<blockquote>
<p>得到连接许可后，对用户的所有操作权限进行检查</p>
</blockquote>
<ul>
<li><p>操作权限检查流程</p>
<blockquote>
<p>以下前5个权限检查中只要有一个权限允许则执行操作，否则执行第六步</p>
</blockquote>
<p>  <kbd>收到用户请求操作</kbd>–&gt;<kbd>user表中权限</kbd>–&gt;<kbd>db和host表中权限</kbd>–&gt;<kbd>tables_priv中权限</kbd>–&gt;<kbd>column_priv中权限</kbd>–&gt;<kbd>第六步，不允许用户请求的操作</kbd></p>
</li>
</ul>
<h2 id="9-2账户管理"><a href="#9-2账户管理" class="headerlink" title="9.2账户管理"></a>9.2账户管理</h2><h3 id="9-2-1-普通用户管理"><a href="#9-2-1-普通用户管理" class="headerlink" title="9.2.1 普通用户管理"></a>9.2.1 普通用户管理</h3><p>9.2.1.1用户创建</p>
<ul>
<li>create语句</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">- </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="keyword">user</span></span><br><span class="line">	[<span class="keyword">identified</span> <span class="keyword">by</span> [<span class="keyword">password</span>] <span class="string">'password'</span>] </span><br><span class="line">	[,<span class="keyword">user</span>[<span class="keyword">identified</span> <span class="keyword">by</span> [<span class="keyword">password</span>]<span class="string">'password'</span>]] </span><br><span class="line">	[,...]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- user格式: 'user_name'@'host_name'</span></span><br><span class="line"><span class="comment">-- host_name: 用户创建的使用mysql的连接来自的主机，若存在_或%则使用单引号括起来，“%”表示一组主机</span></span><br><span class="line"><span class="comment">-- localhost: 本地主机</span></span><br><span class="line"><span class="comment">-- identified by 指定用户密码，用户名密码区分大小写</span></span><br><span class="line"><span class="comment">-- password(): 对密码加密</span></span><br><span class="line"><span class="comment">-- create创建多个用户，使用,分开</span></span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span></span><br><span class="line">	<span class="string">'userDemo1'</span>@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br><span class="line"></span><br><span class="line">- </span><br><span class="line">不指定明文</span><br><span class="line">1.获取密文</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">password</span>(<span class="string">'123456'</span>);</span><br><span class="line"><span class="comment">-- 执行结果：</span></span><br><span class="line"><span class="comment">--    +-------------------------------------------+</span></span><br><span class="line"><span class="comment">--    | password('123456')                        |</span></span><br><span class="line"><span class="comment">--    +-------------------------------------------+</span></span><br><span class="line"><span class="comment">--    | *6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 |</span></span><br><span class="line"><span class="comment">--    +-------------------------------------------+</span></span><br><span class="line">2.创建用户</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'userDemo2'</span>@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="keyword">password</span> <span class="string">'*6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9'</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>grant语句</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> priv_type <span class="keyword">on</span> database.table <span class="keyword">to</span> <span class="keyword">user</span> </span><br><span class="line">	[<span class="keyword">identified</span> <span class="keyword">by</span>[<span class="keyword">password</span>]<span class="string">'password'</span>] </span><br><span class="line">	[,<span class="keyword">user</span>[<span class="keyword">identified</span> <span class="keyword">by</span>[<span class="keyword">password</span>]<span class="string">'password'</span>]]</span><br><span class="line">	[, ...]</span><br><span class="line">	</span><br><span class="line">示例：</span><br><span class="line"><span class="keyword">grant</span> </span><br><span class="line">	<span class="keyword">select</span>, <span class="keyword">update</span> </span><br><span class="line">		<span class="keyword">on</span> jwgl.course </span><br><span class="line">			<span class="keyword">to</span> <span class="string">'userDemo3'</span>@<span class="string">'localhost'</span> </span><br><span class="line">				<span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br></pre></td></tr></table></figure>

<p>9.2.1.2查看用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span> <span class="string">'userDemo1'</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p>9.2.1.3删除用户</p>
<ul>
<li><p>drop</p>
<blockquote>
<p>删除并取消用户权限</p>
<p>要求：</p>
<p>​    使用此语句需要全局create user或delete user权限</p>
<p>​    此语句不可关闭任何打开的用户会话，若存在打开的用户会话，当会话结束后才会生效</p>
</blockquote>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> user_name</span><br><span class="line">	[,user_name]</span><br><span class="line">	[,...]</span><br><span class="line">	</span><br><span class="line">示例：</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">'user_name'</span>@localhost;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>delete</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> mysql.user </span><br><span class="line">	<span class="keyword">where</span> host = <span class="string">'host_name'</span> <span class="keyword">and</span> <span class="keyword">user</span> = <span class="string">'user_name'</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>9.2.1.4修改用户名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">rename</span> <span class="keyword">user</span> old_name <span class="keyword">to</span> new_name</span><br><span class="line">	[,old_name <span class="keyword">to</span> <span class="keyword">new</span> _name]</span><br><span class="line">	[,..]</span><br></pre></td></tr></table></figure>

<h3 id="9-2-2-登录及修改密码"><a href="#9-2-2-登录及修改密码" class="headerlink" title="9.2.2 登录及修改密码"></a>9.2.2 登录及修改密码</h3><p>9.2.2.1 登录mysql服务器</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql -h hostname|hostIP -P port -u username -p DatabaseName -e 'SQL Statements';</span><br><span class="line"></span><br><span class="line"><span class="comment">-- mysql: 登录命令</span></span><br><span class="line"><span class="comment">-- -h hostname|hostIP: 登录主机</span></span><br><span class="line"><span class="comment">-- -P port: 端口，默认3306，可以省略</span></span><br><span class="line"><span class="comment">-- -u username:登录服务器账号名</span></span><br><span class="line"><span class="comment">-- -p : 密码</span></span><br><span class="line"><span class="comment">-- DatabaseName: 要打开的数据库名</span></span><br><span class="line"><span class="comment">-- -e "sql statements": 要执行的SQL语句串</span></span><br><span class="line"><span class="comment">-- 结束符: 以；或者 \g结束</span></span><br></pre></td></tr></table></figure>

<p>9.2.2.2修改用户密码</p>
<blockquote>
<p>可使用mysqladmin，update或set password实现</p>
</blockquote>
<ul>
<li><p>root用户修改自己密码</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.mysqladmin</span><br><span class="line">mysqladmin -u username  -h localhost -p password "new password"</span><br><span class="line"></span><br><span class="line">2.update</span><br><span class="line"><span class="keyword">update</span> mysql.user </span><br><span class="line">	<span class="keyword">set</span> <span class="keyword">password</span>  = <span class="keyword">password</span>(<span class="string">'new_password'</span>) </span><br><span class="line">		<span class="keyword">where</span> <span class="keyword">user</span> = <span class="string">'root'</span> <span class="keyword">and</span> host = <span class="string">'localhost'</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改用户密码</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">password</span> [<span class="keyword">for</span> <span class="keyword">user</span>] = <span class="keyword">password</span>(<span class="string">'new_password'</span>);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="9-3权限管理"><a href="#9-3权限管理" class="headerlink" title="9.3权限管理"></a>9.3权限管理</h2><p>9.3.1权限层级</p>
<ul>
<li>全局层级</li>
<li>数据库层级</li>
<li>表层即</li>
<li>列层级</li>
<li>子程序层级</li>
</ul>
<p>9.3.2授权管理</p>
<p>9.3.2.1 授权grant</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> priv_type[(column_list)]</span><br><span class="line">	[,priv_type[(column_list)]]</span><br><span class="line">	[,...n]</span><br><span class="line">        <span class="keyword">on</span> dbName.tbale_name|*.*|*.tbale_name|dbName.*</span><br><span class="line">            <span class="keyword">to</span> <span class="keyword">user</span>[<span class="keyword">identified</span> <span class="keyword">by</span> [<span class="keyword">password</span>]<span class="string">'password'</span>]</span><br><span class="line">               [,<span class="keyword">user</span>[<span class="keyword">identified</span> <span class="keyword">by</span> [<span class="keyword">password</span>]<span class="string">'password'</span>]]</span><br><span class="line">               [,...n]</span><br><span class="line">                   [<span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>]</span><br></pre></td></tr></table></figure>

<p>9.3.2.2 收回权限revoke</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">收回指定权限</span><br><span class="line"><span class="keyword">revoke</span> priv_type[(column_list)]</span><br><span class="line">	[,priv_type[column_list]]</span><br><span class="line">	[,...n]</span><br><span class="line">		<span class="keyword">on</span> dbName.tbale_name|*.*|*.tbale_name|dbName.*</span><br><span class="line">			<span class="keyword">from</span> <span class="string">'username'</span>@hostName</span><br><span class="line">				[,<span class="string">'username'</span>@hostName]</span><br><span class="line">				[,...n]</span><br><span class="line">收回所有权限</span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">all</span> privilages, <span class="keyword">grant</span> <span class="keyword">option</span> </span><br><span class="line">	<span class="keyword">from</span> <span class="string">'username'</span>@<span class="string">'hostname'</span></span><br><span class="line">	[,<span class="string">'username'</span>@<span class="string">'hostname'</span>]</span><br><span class="line">	[,...n];</span><br></pre></td></tr></table></figure>

<p>9.3.2.3查看权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">grants</span> <span class="keyword">for</span> <span class="string">'username'</span>@<span class="string">'hostname'</span></span><br></pre></td></tr></table></figure>

<h2 id="9-4数据库安全常见问题"><a href="#9-4数据库安全常见问题" class="headerlink" title="9.4数据库安全常见问题"></a>9.4数据库安全常见问题</h2><p>9.4.1权限更改合时生效</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.管理员身份进入命令行</span><br><span class="line"><span class="keyword">flush</span> privieges;</span><br><span class="line"></span><br><span class="line">2.操作系统中</span><br><span class="line">mysqladmin <span class="keyword">flush</span> - <span class="keyword">privileges</span>;</span><br><span class="line"></span><br><span class="line">3.操作系统中</span><br><span class="line">mysqladmin reload;</span><br></pre></td></tr></table></figure>

<p>9.4.2账户密码设置</p>
<blockquote>
<p>不需要password()加密密码,会自动加密</p>
<p>​    grant…identified by</p>
<p>​    mysqladmin password</p>
<p>需要加密，操作针对user表，user表中密码都是加密的</p>
<p>​    set password, insert, update</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.DOS命令窗口中指定密码</span><br><span class="line"></span><br><span class="line">2.set <span class="keyword">password</span> 设置密码</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span><span class="keyword">grant</span> <span class="keyword">usage</span>指定账户密码</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>创建新账户指定密码</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span><span class="keyword">update</span>更新已有账户密码</span><br></pre></td></tr></table></figure>

<p>9.4.3关于mysql中匿名登录</p>
<blockquote>
<p>mysql在windows下一般创建了两个root账户</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.为root账户和匿名账户指定密码</span><br><span class="line"></span><br><span class="line">​	<span class="keyword">set</span> <span class="keyword">password</span> 或 <span class="keyword">update</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>删除匿名账户</span><br></pre></td></tr></table></figure>

<h1 id="10-备份与恢复"><a href="#10-备份与恢复" class="headerlink" title="10.备份与恢复"></a>10.备份与恢复</h1><h2 id="10-1备份，恢复概述"><a href="#10-1备份，恢复概述" class="headerlink" title="10.1备份，恢复概述"></a>10.1备份，恢复概述</h2><p>10.1.1故障原因</p>
<ul>
<li>系统故障</li>
<li>事务故障</li>
<li>介质故障</li>
</ul>
<p>10.1.2备份分类</p>
<p>10.1.2.1按备份时服务器是否在线分</p>
<ul>
<li>热备份</li>
<li>温备份</li>
<li>冷备份</li>
</ul>
<p>10.1.2.3备份内容分</p>
<ul>
<li>逻辑备份</li>
<li>物理备份</li>
</ul>
<p>10.1.2.4备份涉及的数据</p>
<ul>
<li>完整备份</li>
<li>增量备份</li>
<li>差异备份</li>
</ul>
<p>10.1.3备份时机</p>
<ul>
<li>创建数据库，添加数据后</li>
<li>创建索引后</li>
<li>清理事务日志后</li>
<li>执行无日志操作后</li>
</ul>
<p>10.1.4恢复方法</p>
<ul>
<li>数据库备份</li>
<li>二进制日志</li>
<li>数据库复制</li>
</ul>
<h2 id="10-2数据备份"><a href="#10-2数据备份" class="headerlink" title="10.2数据备份"></a>10.2数据备份</h2><p>10.2.1 mysqldump命令</p>
<p>10.2.1.1备份数据库或表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u user -h host -p password</span><br><span class="line">	<span class="comment">-- databasename[all -databases][tablename= ,[tablename= ...]] &gt; filename.sql</span></span><br></pre></td></tr></table></figure>

<p>10.2.1.2备份多个数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u user -h host -p </span><br><span class="line">	<span class="comment">-- databases databasename[ databasename...]</span></span><br><span class="line"><span class="comment">-- 多个数据库名空格隔开</span></span><br></pre></td></tr></table></figure>

<p>10.2.2直接复制整个数据库目录</p>
<p>10.2.3 mysqlhotcopy工具快速复制</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~] <span class="comment"># mysqlhotcopy [option] dbName1 dbName2 ... backupDir/</span></span><br></pre></td></tr></table></figure>

<h2 id="10-3数据恢复"><a href="#10-3数据恢复" class="headerlink" title="10.3数据恢复"></a>10.3数据恢复</h2><p>10.3.1执行相应的备份文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u user -p[databasename]&lt;filename.sql;</span><br></pre></td></tr></table></figure>

<p>10.3.2使用source恢复表和数据库</p>
<p>10.3.2.1恢复表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql命令行:</span><br><span class="line">1.进入数据库</span><br><span class="line">2.执行命令source d:/mysqlDemo1.sql</span><br></pre></td></tr></table></figure>

<p>10.3.2.2恢复数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.进入数据库</span><br><span class="line">2.执行source filename.sql</span><br></pre></td></tr></table></figure>

<h2 id="10-4数据库迁移"><a href="#10-4数据库迁移" class="headerlink" title="10.4数据库迁移"></a>10.4数据库迁移</h2><p>10.4.1相同版本数据库迁移</p>
<blockquote>
<p>迁移前后数据库主版本不同，复制数据库目录（只有数据库表都是MyISAM时才可以）</p>
</blockquote>
<p>10.4.2不同版本的数据库之间的迁移</p>
<p>低版本迁移至高版本</p>
<p>MyISAM：直接复制或者mysqlhotcopy工具</p>
<p>InnoDB：使用mysqldump命令实现</p>
<p>高版本迁移</p>
<p>建议使用mysqldump命令实现</p>
<p>10.4.3不同类型数据库迁移</p>
<blockquote>
<p>没有普遍的实现方法</p>
</blockquote>
<p>10.4.4数据库迁移至新服务器</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u username -p password databasename | mysql - host = hostname -c databasename</span><br><span class="line"></span><br><span class="line"><span class="comment">-- mysqldump其它选项:</span></span><br><span class="line"><span class="comment">-- -add-locks:每个表导出之前添加lock tables,之后unlock table</span></span><br><span class="line"><span class="comment">-- -add-drop-tabls:在每个create语句之前增加一个drop table</span></span><br><span class="line"><span class="comment">-- -allow-keywords:允许创建是关键字的列名字</span></span><br><span class="line"><span class="comment">-- -c, -complete-insert:使用完整的insert语句（用列名）</span></span><br><span class="line"><span class="comment">-- -c, -compress:客户服务器都支持压缩，压缩两者间的所有信息</span></span><br><span class="line"><span class="comment">-- -delayed:用insert delayed命令插入行</span></span><br><span class="line"><span class="comment">-- -e, -extend-insert:使用全新多行insert语法（给出更紧缩更快的插入语句）</span></span><br></pre></td></tr></table></figure>

<h2 id="10-5表的导入与导出"><a href="#10-5表的导入与导出" class="headerlink" title="10.5表的导入与导出"></a>10.5表的导入与导出</h2><p>10.5.1 select…into outfile导出文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> [columnlist] <span class="keyword">from</span> <span class="keyword">table</span> [<span class="keyword">where</span> codition] <span class="keyword">into</span> <span class="keyword">outfile</span><span class="string">'filename'</span> <span class="keyword">option</span></span><br></pre></td></tr></table></figure>

<p>10.5.2 mysql命令导出文本文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -pPassword -e| <span class="comment">-- excute = "select statement" databasename &gt; c:\name.txt;</span></span><br></pre></td></tr></table></figure>

<p>10.5.3  load data infile</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span>[low_prioriy|<span class="keyword">concurrent</span>]</span><br><span class="line">	<span class="keyword">infile</span><span class="string">'filename.txt'</span>[<span class="keyword">replace</span>|<span class="keyword">ignore</span>] </span><br><span class="line">		<span class="keyword">into</span> <span class="keyword">table</span> tbalename [options] [<span class="keyword">ignore</span> <span class="built_in">number</span> <span class="keyword">lines</span>] 			[&#123;columnname[|uservariables],..&#125;]</span><br><span class="line">			[<span class="keyword">set</span> columnname = exression,..]</span><br><span class="line">			</span><br><span class="line"><span class="comment">-- low_prioriy|concurrent:指定low_prioriy延迟语句的执行</span></span><br><span class="line"><span class="comment">-- filename.txt:该文件中保存了待存入数据库的数据行</span></span><br><span class="line"><span class="comment">-- replace|ignore:指定了replace,当文件中出现与原有行相同的唯一关键字值时，输入航替换原有行</span></span><br></pre></td></tr></table></figure>

<h1 id="11-性能优化"><a href="#11-性能优化" class="headerlink" title="11.性能优化"></a>11.性能优化</h1><h2 id="11-1优化数据库服务器"><a href="#11-1优化数据库服务器" class="headerlink" title="11.1优化数据库服务器"></a>11.1优化数据库服务器</h2><p>11.1.1优化服务器硬件</p>
<p>11.1.2修改my.ini文件</p>
<p>11.1.3控制台优化</p>
<p>11.1.3.1查询主要性能参数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'value'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'value'</span>;</span><br></pre></td></tr></table></figure>

<p>11.1.3.2设置性能指标参数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.查看变量</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%query_cache%'</span>;</span><br><span class="line"></span><br><span class="line">2.使用<span class="keyword">set</span> 语句修改值</span><br><span class="line">示例：<span class="keyword">set</span> @@global.query_cache_limit = <span class="number">67108864</span>b;</span><br></pre></td></tr></table></figure>

<h2 id="11-2优化查询"><a href="#11-2优化查询" class="headerlink" title="11.2优化查询"></a>11.2优化查询</h2><h3 id="11-2-1分析查询语句"><a href="#11-2-1分析查询语句" class="headerlink" title="11.2.1分析查询语句"></a>11.2.1分析查询语句</h3><p>11.2.1.1 explain 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">statement</span>;</span><br></pre></td></tr></table></figure>

<p>11.2.1.2 describe语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">describe select statements;</span><br></pre></td></tr></table></figure>

<h3 id="11-2-2使用索引优化查询"><a href="#11-2-2使用索引优化查询" class="headerlink" title="11.2.2使用索引优化查询"></a>11.2.2使用索引优化查询</h3><p>11.2.2.1 应用like关键字优化索引查询</p>
<p>11.2.2.2查询语句中使用or关键字</p>
<p>11.2.2.3查询语句中使用多列索引</p>
<p>11.2.2.4索引字段上使用函数操作</p>
<h3 id="11-2-3优化多表查询"><a href="#11-2-3优化多表查询" class="headerlink" title="11.2.3优化多表查询"></a>11.2.3优化多表查询</h3><h2 id="11-3优化数据结构"><a href="#11-3优化数据结构" class="headerlink" title="11.3优化数据结构"></a>11.3优化数据结构</h2><h3 id="11-3-1优化表结构"><a href="#11-3-1优化表结构" class="headerlink" title="11.3.1优化表结构"></a>11.3.1优化表结构</h3><p>11.3.1.1字段很多的表分解为多个表</p>
<p>11.3.1.2增加冗余字段</p>
<p>11.3.1.3合理设置表的数据类型和属性</p>
<h3 id="11-3-2增加中间表"><a href="#11-3-2增加中间表" class="headerlink" title="11.3.2增加中间表"></a>11.3.2增加中间表</h3><h3 id="11-3-3优化插入记录速度"><a href="#11-3-3优化插入记录速度" class="headerlink" title="11.3.3优化插入记录速度"></a>11.3.3优化插入记录速度</h3><h3 id="11-3-4分析表，检查表和优化表"><a href="#11-3-4分析表，检查表和优化表" class="headerlink" title="11.3.4分析表，检查表和优化表"></a>11.3.4分析表，检查表和优化表</h3><p>11.3.4.1利用analyze语句分析表</p>
<p>11.3.4.2使用check 语句检查表</p>
<p>11.3.4.3使用optimize优化表</p>
<h3 id="11-3-5优化慢查询"><a href="#11-3-5优化慢查询" class="headerlink" title="11.3.5优化慢查询"></a>11.3.5优化慢查询</h3><h3 id="11-3-6优化表设计"><a href="#11-3-6优化表设计" class="headerlink" title="11.3.6优化表设计"></a>11.3.6优化表设计</h3><h2 id="11-4查询高速缓存"><a href="#11-4查询高速缓存" class="headerlink" title="11.4查询高速缓存"></a>11.4查询高速缓存</h2><p>11.4.1检验高速缓存是否开启</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%query_cache'</span>;</span><br></pre></td></tr></table></figure>

<p>11.4.2使用高速缓存</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用<span class="keyword">set</span>命令设定有关值即可</span><br></pre></td></tr></table></figure>

<h2 id="11-5优化性能的其它方面"><a href="#11-5优化性能的其它方面" class="headerlink" title="11.5优化性能的其它方面"></a>11.5优化性能的其它方面</h2><p>11.5.1 limit 1:查询结果只有1行时可以提升速率</p>
<p>11.5.2 少用select * from table_name，尽量明确字段</p>
<p>11.5.3 不滥用sql自动转换</p>
<p>11.5.4 避免在where子句中对null判断</p>
<p>11.5.5 避免在where子句中使用“！=”或”&lt;&gt;”操作符</p>
<p>11.5.6 避免where子句对字段进行表达式操作</p>
<p>11.5.7 避免使用in或not in</p>
<h1 id="12-日志文件管理"><a href="#12-日志文件管理" class="headerlink" title="12.日志文件管理"></a>12.日志文件管理</h1><h2 id="12-1错误日志"><a href="#12-1错误日志" class="headerlink" title="12.1错误日志"></a>12.1错误日志</h2><p>12.1.1启用和设置错误日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">将log-error添加到my.ini文件的[mysqld]组中</span><br><span class="line"><span class="comment"># my.ini</span></span><br><span class="line">log-error=[path/[filename]]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- path:日志文件路径</span></span><br><span class="line"><span class="comment">-- filename:日志文件名</span></span><br></pre></td></tr></table></figure>

<p>12.1.2查看错误日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'log_error'</span>;</span><br></pre></td></tr></table></figure>

<p>12.1.3删除错误日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -u root -p <span class="keyword">flush</span> - <span class="keyword">logs</span></span><br></pre></td></tr></table></figure>

<h2 id="12-2二进制日志"><a href="#12-2二进制日志" class="headerlink" title="12.2二进制日志"></a>12.2二进制日志</h2><p>12.2.1启用二进制日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my.ini文件的log-ini文件的log-bin选项可以开启二进制日志</span><br><span class="line"><span class="comment">#my.ini文件</span></span><br><span class="line">[mysqld]</span><br><span class="line">log-bin[=path\[filename]]</span><br><span class="line">expire_logs_days = 10</span><br><span class="line">max_binlog_size = 100M</span><br></pre></td></tr></table></figure>

<p>12.2.2查看二进制日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="built_in">binary</span> <span class="keyword">logs</span>;</span><br><span class="line"></span><br><span class="line">mysqlbinlog filename.number</span><br></pre></td></tr></table></figure>

<p>12.2.3清理二进制日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">删除所有</span><br><span class="line"><span class="keyword">reset</span> <span class="keyword">master</span>;</span><br><span class="line"></span><br><span class="line">删除指定的日志文件</span><br><span class="line"><span class="keyword">purge</span> <span class="keyword">master</span> <span class="keyword">logs</span>语句</span><br><span class="line">格式：</span><br><span class="line"><span class="keyword">purge</span> &#123;<span class="built_in">binary</span>|<span class="keyword">master</span>&#125; <span class="keyword">logs</span> <span class="keyword">to</span> <span class="string">'log_name'</span></span><br><span class="line"><span class="keyword">purge</span> &#123;<span class="built_in">binary</span>|<span class="keyword">master</span>&#125; <span class="keyword">logs</span> <span class="keyword">before</span> <span class="string">'date'</span></span><br></pre></td></tr></table></figure>

<p>12.2.4二进制日志恢复数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [option]filename|mysql -u user -p password</span><br></pre></td></tr></table></figure>

<p>12.2.5暂时停止二进制日志功能</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> sql_log_bin = &#123;<span class="number">0</span>|<span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="12-3通用查询日志"><a href="#12-3通用查询日志" class="headerlink" title="12.3通用查询日志"></a>12.3通用查询日志</h2><p>12.3.1启动和设置通用查询日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#my.ini文件</span></span><br><span class="line">[mysqld]</span><br><span class="line">log[=path\[filename]]</span><br><span class="line"></span><br><span class="line">不指定参数</span><br><span class="line">[mysqld]</span><br><span class="line">log</span><br></pre></td></tr></table></figure>

<p>12.3.2查看通用日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">日志以文本文件存储，使用文本文件查看器查看</span><br></pre></td></tr></table></figure>

<p>12.3.3删除通用查询日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">开启新通用日志可覆盖之前的日志</span><br><span class="line">mysqladmin -u root -p <span class="keyword">flush</span> -<span class="keyword">logs</span></span><br></pre></td></tr></table></figure>

<h2 id="12-4慢查询日志"><a href="#12-4慢查询日志" class="headerlink" title="12.4慢查询日志"></a>12.4慢查询日志</h2><p>12.4.1启用慢查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#my.ini</span></span><br><span class="line">[mysqld]</span><br><span class="line">log - slow - queries[=path\[filename]]</span><br><span class="line">long_query_time = n</span><br></pre></td></tr></table></figure>

<p>12.4.2操作慢查询日志</p>
<p>12.4.3删除慢查询日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -u root -p <span class="keyword">flush</span> - <span class="keyword">logs</span></span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Alex</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://herycs.github.io/2018/06/08/mysql-b-note1/">https://herycs.github.io/2018/06/08/mysql-b-note1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mysql/">mysql</a></div><div class="post_share"><div class="social-share" data-image="/img/post.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2018/06/21/linux-a-cmd/"><img class="prev_cover lazyload" data-src="/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">linux-a-cmd.md</div></div></a></div><div class="next-post pull_right"><a href="/2018/03/24/mysql-a-crud/"><img class="next_cover lazyload" data-src="/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">mysql-a-crud.md</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2018/07/22/mysql-a-dump/" title="mysql-a-dump.md"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-07-22</div><div class="relatedPosts_title">mysql-a-dump.md</div></div></a></div><div class="relatedPosts_item"><a href="/2018/03/24/mysql-a-crud/" title="mysql-a-crud.md"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-03-24</div><div class="relatedPosts_title">mysql-a-crud.md</div></div></a></div><div class="relatedPosts_item"><a href="/2018/07/14/mysql-a-safe/" title="mysql-a-safe.md"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-07-14</div><div class="relatedPosts_title">mysql-a-safe.md</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Alex</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>